Cháº¯c cháº¯n rá»“i! Äá»ƒ tá»•ng há»£p láº¡i toÃ n bá»™ quy trÃ¬nh, Ä‘Ã¢y lÃ  hÆ°á»›ng dáº«n tá»«ng bÆ°á»›c chi tiáº¿t Ä‘á»ƒ xÃ¢y dá»±ng vÃ  triá»ƒn khai á»©ng dá»¥ng Chuyá»ƒn Ä‘á»•i & Thanh toÃ¡n Stablecoin XuyÃªn biÃªn giá»›i trÃªn Arc, tÃ­ch há»£p cÃ¡c cÃ´ng nghá»‡ Ä‘Ã£ tháº£o luáº­n: StableFX, Permit2, Chainlink, vÃ  Fiat On/Off-Ramps.

## ğŸ› ï¸ HÆ°á»›ng Dáº«n Tá»«ng BÆ°á»›c Triá»ƒn khai á»¨ng dá»¥ng FX trÃªn Arc

### Giai Ä‘oáº¡n 1: Chuáº©n bá»‹ CÆ¡ sá»Ÿ háº¡ táº§ng (Setup & Environment)

| BÆ°á»›c | MÃ´ táº£ CÃ´ng viá»‡c | Má»¥c tiÃªu |
| :--- | :--- | :--- |
| **1.1. Thiáº¿t láº­p Dá»± Ã¡n EVM** | Sá»­ dá»¥ng Hardhat hoáº·c Foundry Ä‘á»ƒ táº¡o dá»± Ã¡n vÃ  cÃ i Ä‘áº·t thÆ° viá»‡n web3 (Ethers.js/ViÃªm) Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i Arc. | MÃ´i trÆ°á»ng phÃ¡t triá»ƒn sáºµn sÃ ng. |
| **1.2. Káº¿t ná»‘i Arc Network** | Cáº¥u hÃ¬nh RPC endpoint cho Arc Testnet hoáº·c Mainnet. Äáº£m báº£o báº¡n cÃ³ khÃ³a API vÃ  tÃ i khoáº£n vÃ­ chá»©a cÃ¡c Stablecoin thá»­ nghiá»‡m (USDC, JPYC, v.v.). | Truy cáº­p vÃ  giao dá»‹ch Ä‘Æ°á»£c trÃªn Arc. |
| **1.3. XÃ¡c Ä‘á»‹nh Há»£p Ä‘á»“ng (Contracts)** | Thu tháº­p Ä‘á»‹a chá»‰ cá»§a **Permit2**, **StableFX**, cÃ¡c token **Stablecoin** (USDC, JPYC), vÃ  **Chainlink Data Feed** cho cÃ¡c cáº·p FX (vÃ­ dá»¥: USD/JPY) trÃªn Arc. | CÃ¡c Ä‘á»‹a chá»‰ on-chain cáº§n thiáº¿t Ä‘Ã£ cÃ³. |

### Giai Ä‘oáº¡n 2: TÃ­ch há»£p Quáº£n lÃ½ TÃ i sáº£n (Permit2 & Tokens)

| BÆ°á»›c | MÃ´ táº£ CÃ´ng viá»‡c | Má»¥c tiÃªu |
| :--- | :--- | :--- |
| **2.1. PhÃª duyá»‡t Master (Master Approval)** | Tá»• chá»©c TÃ i chÃ­nh (OFI) gá»­i giao dá»‹ch **má»™t láº§n** Ä‘á»ƒ cáº¥p quyá»n `approve` sá»‘ lÆ°á»£ng tá»‘i Ä‘a token (vÃ­ dá»¥: USDC, JPYC) cho Ä‘á»‹a chá»‰ há»£p Ä‘á»“ng **Permit2**. | Cho phÃ©p Permit2 quáº£n lÃ½ tÃ i sáº£n cá»§a OFI. |
| **2.2. XÃ¢y dá»±ng Logic Nonce** | Thiáº¿t láº­p má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u ngoÃ i chuá»—i Ä‘á»ƒ theo dÃµi `nonce` Ä‘Ã£ sá»­ dá»¥ng cho má»—i vÃ­ OFI Ä‘á»ƒ ngÄƒn cháº·n táº¥n cÃ´ng phÃ¡t láº¡i (replay attack) chá»¯ kÃ½ Permit2. | Báº£o máº­t chá»¯ kÃ½ Permit2. |

### Giai Ä‘oáº¡n 3: TÃ­nh toÃ¡n Tá»· lá»‡ Quy Ä‘á»•i (FX Rates & Spread)

| BÆ°á»›c | MÃ´ táº£ CÃ´ng viá»‡c | Má»¥c tiÃªu |
| :--- | :--- | :--- |
| **3.1. Truy váº¥n Chainlink (On-chain/Off-chain)** | Gá»i hÃ m `latestRoundData()` cá»§a Há»£p Ä‘á»“ng Chainlink Aggregator (vÃ­ dá»¥: USD/JPY Feed) Ä‘á»ƒ láº¥y tá»· giÃ¡ giao ngay (Mid-Market Rate). | CÃ³ Ä‘Æ°á»£c tá»· giÃ¡ FX trung tÃ¢m Ä‘Ã¡ng tin cáº­y. |
| **3.2. TÃ­nh toÃ¡n Spread & RFQ** | **Há»‡ thá»‘ng Backend (RFQ Engine)** cá»§a báº¡n nháº­n Mid-Rate, Ã¡p dá»¥ng Spread theo chÃ­nh sÃ¡ch kinh doanh (vÃ­ dá»¥: $0.1\%$). TÃ­nh toÃ¡n tá»· giÃ¡ Mua (Bid) vÃ  BÃ¡n (Ask). | Táº¡o ra bÃ¡o giÃ¡ cuá»‘i cÃ¹ng cÃ³ lá»£i nhuáº­n. |
| **3.3. Táº¡o Dá»¯ liá»‡u Thanh toÃ¡n** | Sá»­ dá»¥ng bÃ¡o giÃ¡ cuá»‘i cÃ¹ng Ä‘á»ƒ táº¡o ra **`settlement_data`** (dá»¯ liá»‡u giao dá»‹ch) bao gá»“m sá»‘ lÆ°á»£ng, thá»i háº¡n, vÃ  Ä‘á»‹a chá»‰ cá»§a StableFX. | Chuáº©n bá»‹ dá»¯ liá»‡u cho giao dá»‹ch on-chain. |



### Giai Ä‘oáº¡n 4: Thá»±c hiá»‡n Giao dá»‹ch Thanh toÃ¡n (StableFX Execution)

| BÆ°á»›c | MÃ´ táº£ CÃ´ng viá»‡c | Má»¥c tiÃªu |
| :--- | :--- | :--- |
| **4.1. KÃ½ Chá»¯ kÃ½ Permit2** | Sá»­ dá»¥ng vÃ­ cá»§a OFI Ä‘á»ƒ kÃ½ thÃ´ng bÃ¡o ngoÃ i chuá»—i (EIP-712) cho phÃ©p StableFX rÃºt sá»‘ lÆ°á»£ng token cáº§n thiáº¿t tá»« vÃ­. | Táº¡o `permit2_signature` an toÃ n vÃ  hiá»‡u quáº£. |
| **4.2. Gá»­i Giao dá»‹ch `settle()`** | Gá»­i giao dá»‹ch lÃªn Arc, gá»i hÃ m `StableFX.settle()` vá»›i hai tham sá»‘ chÃ­nh: `settlement_data` vÃ  `permit2_signature`. | Thá»±c hiá»‡n hoÃ¡n Ä‘á»•i Stablecoin-to-Stablecoin an toÃ n (PvP). |
| **4.3. Kiá»ƒm tra Slippage (On-chain)** | Há»£p Ä‘á»“ng StableFX kiá»ƒm tra tá»· giÃ¡ thá»±c táº¿ cÃ³ náº±m trong giá»›i háº¡n Slippage Ä‘Æ°á»£c thiáº¿t láº­p trong `settlement_data` khÃ´ng. Náº¿u khÃ´ng, giao dá»‹ch sáº½ hoÃ n tÃ¡c. | Báº£o vá»‡ giao dá»‹ch khá»i trÆ°á»£t giÃ¡ ngoÃ i Ã½ muá»‘n. |

### Giai Ä‘oáº¡n 5: TÃ­ch há»£p Fiat On/Off-Ramps (HoÃ n táº¥t)

| BÆ°á»›c | MÃ´ táº£ CÃ´ng viá»‡c | Má»¥c tiÃªu |
| :--- | :--- | :--- |
| **5.1. On-Ramp (Fiat $\rightarrow$ Stablecoin)** | HÆ°á»›ng dáº«n OFI sá»­ dá»¥ng tÃ i khoáº£n Circle Mint hoáº·c cÃ¡c Ä‘á»‘i tÃ¡c Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ©p Ä‘á»ƒ chuyá»ƒn tiá»n fiat (USD/JPY) vÃ  nháº­n Stablecoin (USDC/JPYC) tÆ°Æ¡ng á»©ng trÃªn Arc. | Náº¡p tiá»n vÃ o vÃ­ on-chain. |
| **5.2. Off-Ramp (Stablecoin $\rightarrow$ Fiat)** | Khi OFI muá»‘n rÃºt tiá»n, há» gá»­i lá»‡nh `redeem` qua API/ná»n táº£ng cá»§a Circle hoáº·c Ä‘á»‘i tÃ¡c, chuyá»ƒn Stablecoin trá»Ÿ láº¡i Ä‘á»‹a chá»‰ Ä‘á»‘t (burn address). | Chuyá»ƒn Stablecoin thÃ nh tiá»n fiat trong ngÃ¢n hÃ ng. |
| **5.3. Há»— trá»£ NgÆ°á»i dÃ¹ng** | Cung cáº¥p tÃ i liá»‡u hÆ°á»›ng dáº«n vÃ  liÃªn káº¿t rÃµ rÃ ng vá» quy trÃ¬nh on/off ramp cá»§a cÃ¡c nhÃ  phÃ¡t hÃ nh Stablecoin Ä‘á»‘i tÃ¡c (JPYC, AUDF). | Äáº£m báº£o ngÆ°á»i dÃ¹ng biáº¿t cÃ¡ch hoÃ n táº¥t vÃ²ng thanh toÃ¡n. |

CÃ¡c bÆ°á»›c nÃ y Ä‘áº£m báº£o báº¡n cÃ³ má»™t giáº£i phÃ¡p toÃ n diá»‡n: sá»­ dá»¥ng Chainlink cho Ä‘á»‹nh giÃ¡ an toÃ n, Permit2 cho tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng hiá»‡u quáº£, StableFX cho thá»±c hiá»‡n giao dá»‹ch an toÃ n (PvP), vÃ  tÃ­ch há»£p cÃ¡c kÃªnh Mint/Redeem cho quy trÃ¬nh Fiat on/off-ramp.

Báº¡n cÃ³ muá»‘n xem má»™t vÃ­ dá»¥ chi tiáº¿t hÆ¡n vá» cáº¥u trÃºc cá»§a **Há»‡ thá»‘ng BÃ¡o giÃ¡ RFQ NgoÃ i chuá»—i** khÃ´ng?